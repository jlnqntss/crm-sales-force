<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Realiza un &apos;distinct&apos; sobre el campo departamento de los usuarios</description>
        <name>RemoveDuplicatesAction</name>
        <label>Remove duplicated departments</label>
        <locationX>1029</locationX>
        <locationY>566</locationY>
        <actionName>RemoveDuplicatesAction</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>UserListToTextListLoop</targetReference>
        </connector>
        <dataTypeMappings>
            <typeName>T__listToRemove</typeName>
            <typeValue>User</typeValue>
        </dataTypeMappings>
        <dataTypeMappings>
            <typeName>U__output</typeName>
            <typeValue>User</typeValue>
        </dataTypeMappings>
        <flowTransactionModel>Automatic</flowTransactionModel>
        <inputParameters>
            <name>fieldApiName</name>
            <value>
                <stringValue>Department</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>listToRemove</name>
            <value>
                <elementReference>GetAvailableDepartmentsAction</elementReference>
            </value>
        </inputParameters>
        <nameSegment>RemoveDuplicatesAction</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Envia una notificacion a la persona a la que se ha escalado el caso</description>
        <name>SendCustomNotificationAction</name>
        <label>Send custom notification</label>
        <locationX>754</locationX>
        <locationY>3794</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>ScalingSucceededScreen</targetReference>
        </connector>
        <faultConnector>
            <targetReference>CreateRecordsSendNotificationErrorAction</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>GetCustomNotificationAction.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>NotificationRecipientsList</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>Nuevo caso escalado</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>BodyNotificationFormula</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>NewTaskId</elementReference>
            </value>
        </inputParameters>
        <nameSegment>customNotificationAction</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Hace la peticion a canal unico (asincrono) con los datos informados</description>
        <name>SendDocCanalUnicoAction</name>
        <label>Send scalation to canal unico</label>
        <locationX>2822</locationX>
        <locationY>2738</locationY>
        <actionName>SendDocCanalUnicoAction</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>PartnerDataAssignment</targetReference>
        </connector>
        <flowTransactionModel>Automatic</flowTransactionModel>
        <inputParameters>
            <name>sendDocObject</name>
            <value>
                <elementReference>SendDocInfoObject</elementReference>
            </value>
        </inputParameters>
        <nameSegment>SendDocCanalUnicoAction</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>60.0</apiVersion>
    <assignments>
        <name>AddContentDocumentLinkAssignment</name>
        <label>Add content document link</label>
        <locationX>754</locationX>
        <locationY>3170</locationY>
        <assignmentItems>
            <assignToReference>ContentDocumentLinkToCreate.ContentDocumentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CreateDocumentLinksLoop</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContentDocumentLinkToCreate.LinkedEntityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>NewTaskId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContentDocumentLinkToCreate.ShareType</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>V</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContentDocumentLinkToCreate.Visibility</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>AllUsers</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContentDocumentLinkListToCreate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ContentDocumentLinkToCreate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CreateDocumentLinksLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Agrega a la lista de departamentos el del usuario actual del loop</description>
        <name>AddDepartmentAssignament</name>
        <label>Add department</label>
        <locationX>1117</locationX>
        <locationY>782</locationY>
        <assignmentItems>
            <assignToReference>DepartmentList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>UserListToTextListLoop.Department</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>UserListToTextListLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Agrega a la variable de las extensiones permitidas la actual del bucle</description>
        <name>AddFileExtensionAssignment</name>
        <label>Add file extension</label>
        <locationX>1117</locationX>
        <locationY>1190</locationY>
        <assignmentItems>
            <assignToReference>AllowedFileTypes</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>FileExtensionWithPointFormula</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AvailableFileListToTextLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Suma el tamaño del fichero actual al total</description>
        <name>AddFileSizeAssignment</name>
        <label>Add file size</label>
        <locationX>1117</locationX>
        <locationY>2114</locationY>
        <assignmentItems>
            <assignToReference>TotalFileSizeAttached</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>AttachedFilesSizeLoop.ContentSize</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AttachedFilesSizeLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Agrega el identificador del supervisor a la lista de texto de identificadores de supervisor</description>
        <name>AddManagerIdAssignment</name>
        <label>Add manager id</label>
        <locationX>2514</locationX>
        <locationY>2846</locationY>
        <assignmentItems>
            <assignToReference>ManagerIdList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>UserListToManagerIdListLoop.Manager.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>UserListToManagerIdListLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Se agrega la persona a la que se ha escalado el caso a la lista de personas a notificar</description>
        <name>AddOwnerIdToListAssignment</name>
        <label>Add owner id to list</label>
        <locationX>754</locationX>
        <locationY>3578</locationY>
        <assignmentItems>
            <assignToReference>NotificationRecipientsList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>TaskOwnerIdVar</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>GetCustomNotificationAction</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Se setean los campos necesarios para crear la tarea y actualizar el caso para el caso del partner</description>
        <name>PartnerDataAssignment</name>
        <label>Partner data</label>
        <locationX>2822</locationX>
        <locationY>2846</locationY>
        <assignmentItems>
            <assignToReference>TaskOwnerIdVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>SupervisorSelectionInput</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PendingByVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Partner</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TaskStatus</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Cerrada</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TaskOwnerIdVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GetCaseAction.OwnerId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>CreateTaskAction</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Pone a 0 la variable que contiene el tamaño total de archivos adjuntos</description>
        <name>ResetAttachedFileSizeVariableAssignment</name>
        <label>Reset attached file size variable</label>
        <locationX>1029</locationX>
        <locationY>1898</locationY>
        <assignmentItems>
            <assignToReference>TotalFileSizeAttached</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AttachedFilesSizeLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Asignacion de variables para el correcto funcionamiento del flujo</description>
        <name>ScalationWithoutPartnerDataAssignment</name>
        <label>Scalation without partner data</label>
        <locationX>1161</locationX>
        <locationY>1598</locationY>
        <assignmentItems>
            <assignToReference>ScalationSelected</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>SupportSupervisorInput</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CommentsSelected</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CommentsWithoutPartnerInput</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>UploadedFileList</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AttachFilesWithoutPartnerInput.contentDocIds</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>GetAttachedFilesAction</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Asignacion de variables para el correcto funcionamiento del flujo</description>
        <name>ScalationWithPartnerDataAssignment</name>
        <label>Scalation with partner data</label>
        <locationX>897</locationX>
        <locationY>1598</locationY>
        <assignmentItems>
            <assignToReference>ScalationSelected</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>SupportSupervisorPartnerInput</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CommentsSelected</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CommentsWithPartnerInput</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>UploadedFileList</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AttachFilesWithPartnerInput.contentDocIds</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>GetAttachedFilesAction</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Informar el objeto de envio a crear</description>
        <name>SendDocObjectCreationAssignment</name>
        <label>Send doc object creation</label>
        <locationX>2822</locationX>
        <locationY>2522</locationY>
        <assignmentItems>
            <assignToReference>SendDocInfoObject.CaseId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SendDocInfoObject.Comments__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CommentsSelected</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SendDocInfoObject.ContentDocIds__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ContentDocIdListString</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CreateSendInfoObjectAction</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Se setean los campos necesarios para crear la tarea y actualizar el caso para el caso del supervisor</description>
        <name>SupervisorDataAssignment</name>
        <label>Supervisor data</label>
        <locationX>2558</locationX>
        <locationY>3446</locationY>
        <assignmentItems>
            <assignToReference>TaskOwnerIdVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>SupervisorSelectionInput</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PendingByVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Supervisor</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>CreateTaskAction</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Se setean los campos necesarios para crear la tarea y actualizar el caso para el caso de soporte</description>
        <name>SupportDataAssignment</name>
        <label>Support data</label>
        <locationX>666</locationX>
        <locationY>2738</locationY>
        <assignmentItems>
            <assignToReference>TaskOwnerIdVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AgentSelectionInput</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PendingByVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Support</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CreateTaskAction</targetReference>
        </connector>
    </assignments>
    <choices>
        <description>Seleccion de partner. El valor es el mismo que el del picklist Activity.Subtype__c para partner</description>
        <name>PartnerChoice</name>
        <choiceText>Partner</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Scaled partner</stringValue>
        </value>
    </choices>
    <choices>
        <description>Seleccion de supervisor. El valor es el mismo que el del picklist Activity.Subtype__c para supervisor</description>
        <name>SupervisorChoice</name>
        <choiceText>Supervisor</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Scaled Supervisor</stringValue>
        </value>
    </choices>
    <choices>
        <description>Seleccion de soporte. El valor es el mismo que el del picklist Activity.Subtype__c para soporte</description>
        <name>SupportChoice</name>
        <choiceText>Soporte</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Scaled support</stringValue>
        </value>
    </choices>
    <constants>
        <description>Tamaño maximo de la suma de todos los adjuntos (2 Mb) expresado en bytes</description>
        <name>MAX_ATTACHED_FILE_SIZE_MB</name>
        <dataType>Number</dataType>
        <value>
            <numberValue>2097152.0</numberValue>
        </value>
    </constants>
    <constants>
        <description>Developer name del rol &apos;ZDA Agente&apos;</description>
        <name>ZDA_AGENT_ROLE_DEVELOPER_NAME</name>
        <dataType>String</dataType>
        <value>
            <stringValue>ZDA_Agente</stringValue>
        </value>
    </constants>
    <decisions>
        <description>No se permiten escalar casos en estado nuevo o cerrado</description>
        <name>AllowScalationDecision</name>
        <label>Allow scalation</label>
        <locationX>539</locationX>
        <locationY>242</locationY>
        <defaultConnector>
            <targetReference>GetZDARoleIdAction</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Yes</defaultConnectorLabel>
        <rules>
            <name>NoAllowScalationOutcome</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>GetCaseAction.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Nuevo</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cerrado</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cerrado sin respuesta</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>NotAllowedScalationScreen</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se comprueba si existen supervisores definidos</description>
        <name>AreAvailableManagersDecision</name>
        <label>Are available managers</label>
        <locationX>2426</locationX>
        <locationY>3122</locationY>
        <defaultConnector>
            <targetReference>GetManagersInfoAction</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Yes</defaultConnectorLabel>
        <rules>
            <name>NoManagersAvailableOutcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ManagerIdList</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>NoAvailableManagersScreen</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <description>Comprueba si el campo supervisor esta informado</description>
        <name>HasManagerDecision</name>
        <label>Has manager</label>
        <locationX>2646</locationX>
        <locationY>2738</locationY>
        <defaultConnector>
            <targetReference>UserListToManagerIdListLoop</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesHasManagerOutcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>UserListToManagerIdListLoop.Manager.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>UserListToManagerIdListLoop.Manager.Name</leftValueReference>
                <operator>EqualTo</operator>
            </conditions>
            <connector>
                <targetReference>AddManagerIdAssignment</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>En funcion de los datos que tenga informados el caso, se permitira el escalado a partner o no</description>
        <name>IsPartnerScalationAvailableDecision</name>
        <label>Is partner scalation available</label>
        <locationX>1029</locationX>
        <locationY>1382</locationY>
        <defaultConnector>
            <targetReference>ScalationDataWithoutPartnerScreen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesAvailablePartner</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetCaseAction.Origin</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>CanalUnico</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.CuTicketId__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>EscalationDataWithPartnerScreen</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se comprueba si el tamaño maximo ha sido excedido</description>
        <name>MaxFileSizeExceededDecision</name>
        <label>Max file size exceeded</label>
        <locationX>1029</locationX>
        <locationY>2306</locationY>
        <defaultConnector>
            <targetReference>SupportPartnerSupervisorDecision</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesFileSizeExceededOutcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>TotalFileSizeAttached</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <elementReference>MAX_ATTACHED_FILE_SIZE_MB</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>IsPartnerScalationAvailableDecision</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se decide si se envia notificacion a la persona a la que se ha escalado. Si es partner no se debe crear, ya que la persona asignada a la tarea es el agente que ha realizado el escalado</description>
        <name>SendCustomNotificationDecision</name>
        <label>Send custom notification</label>
        <locationX>666</locationX>
        <locationY>3470</locationY>
        <defaultConnector>
            <targetReference>AddOwnerIdToListAssignment</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Yes</defaultConnectorLabel>
        <rules>
            <name>NoSendCustomNotificationOutcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ScalationSelected</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>PartnerChoice</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>ScalingSucceededScreen</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <description>En función del tipo de escalado seleccionado se ejecutarán unas acciones u otras</description>
        <name>SupportPartnerSupervisorDecision</name>
        <label>Support, Supervisor or Partner</label>
        <locationX>1744</locationX>
        <locationY>2414</locationY>
        <defaultConnector>
            <targetReference>SendDocObjectCreationAssignment</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Partner</defaultConnectorLabel>
        <rules>
            <name>SupportOutcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ScalationSelected</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>SupportChoice</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>TeamSelectionScreen</targetReference>
            </connector>
            <label>Support</label>
        </rules>
        <rules>
            <name>SupervisorOutcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ScalationSelected</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>SupervisorChoice</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetManagersAction</targetReference>
            </connector>
            <label>Supervisor</label>
        </rules>
    </decisions>
    <description>Screen flow para el escalado de casos de ZDA</description>
    <dynamicChoiceSets>
        <description>Departamentos disponibles para hacer escalado</description>
        <name>AvailableDepartmentsChoiceSet</name>
        <collectionReference>RemoveDuplicatesAction</collectionReference>
        <dataType>String</dataType>
        <displayField>Department</displayField>
        <object>User</object>
        <valueField>Department</valueField>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>Lista de seleccion que contiene los supervisores disponibles</description>
        <name>AvailableManagersCollectionChoiceSet</name>
        <collectionReference>GetManagersInfoAction</collectionReference>
        <dataType>String</dataType>
        <displayField>Name</displayField>
        <object>User</object>
        <valueField>Id</valueField>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>Contiene una lista de seleccion de usuarios pertenecientes al departamento seleccionado</description>
        <name>AvailableUsersForDepartment</name>
        <dataType>String</dataType>
        <displayField>Name</displayField>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Department</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>DepartmentSelectionInput</elementReference>
            </value>
        </filters>
        <object>User</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <valueField>Id</valueField>
    </dynamicChoiceSets>
    <environments>Default</environments>
    <formulas>
        <description>Formula para establecer el cuerpo de la notificación custom</description>
        <name>BodyNotificationFormula</name>
        <dataType>String</dataType>
        <expression>{!TaskBodyStart} + {!GetCaseAction.CaseNumber}</expression>
    </formulas>
    <formulas>
        <description>Lista de identificadores de ficheros adjuntos</description>
        <name>ContentDocIdListString</name>
        <dataType>String</dataType>
        <expression>{!UploadedFileList}</expression>
    </formulas>
    <formulas>
        <description>Extension del fichero concatenando un punto por delante y una coma por detras para construir el string de tipos de fichero admitidos</description>
        <name>FileExtensionWithPointFormula</name>
        <dataType>String</dataType>
        <expression>&quot;.&quot;&amp;{!AvailableFileListToTextLoop.Label}&amp;&quot;,&quot;</expression>
    </formulas>
    <interviewLabel>ZDA - Case escalation screen {!$Flow.CurrentDateTime}</interviewLabel>
    <label>ZDA - Case escalation screen</label>
    <loops>
        <description>Bucle para calcular el tamaño total de los adjuntos</description>
        <name>AttachedFilesSizeLoop</name>
        <label>Attached files size</label>
        <locationX>1029</locationX>
        <locationY>2006</locationY>
        <collectionReference>GetAttachedFilesAction</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AddFileSizeAssignment</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>MaxFileSizeExceededDecision</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Pasar de una lista de extensiones de fichero validas a un string</description>
        <name>AvailableFileListToTextLoop</name>
        <label>Available file list to text</label>
        <locationX>1029</locationX>
        <locationY>1082</locationY>
        <collectionReference>GetAvailableFileTypesToAttachAction</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AddFileExtensionAssignment</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>IsPartnerScalationAvailableDecision</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Crea el link entre los ficheros adjuntos y la tarea creada</description>
        <name>CreateDocumentLinksLoop</name>
        <label>Create document links loop</label>
        <locationX>666</locationX>
        <locationY>3062</locationY>
        <collectionReference>UploadedFileList</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AddContentDocumentLinkAssignment</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>CreateContentDocumentLinksAction</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Convierte la lista de usuarios en una lista de identificadores de supervisor</description>
        <name>UserListToManagerIdListLoop</name>
        <label>User list to manager id list</label>
        <locationX>2426</locationX>
        <locationY>2630</locationY>
        <collectionReference>GetManagersAction</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>HasManagerDecision</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>AreAvailableManagersDecision</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Convierte la lista de departamentos dentro del objeto Usuario a una lista de strings</description>
        <name>UserListToTextListLoop</name>
        <label>User list to text list</label>
        <locationX>1029</locationX>
        <locationY>674</locationY>
        <collectionReference>RemoveDuplicatesAction</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AddDepartmentAssignament</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>GetAvailableFileTypesToAttachAction</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <description>Crea la lista de content document links para asociar los adjuntos con la tarea creada</description>
        <name>CreateContentDocumentLinksAction</name>
        <label>Create content document links</label>
        <locationX>666</locationX>
        <locationY>3362</locationY>
        <connector>
            <targetReference>SendCustomNotificationDecision</targetReference>
        </connector>
        <inputReference>ContentDocumentLinkListToCreate</inputReference>
    </recordCreates>
    <recordCreates>
        <description>Crea un registro de log erroneo con el error producido al obtener la notificacion custom</description>
        <name>CreateRecordsGetNotificationErrorAction</name>
        <label>Create record get notification error</label>
        <locationX>1282</locationX>
        <locationY>3794</locationY>
        <connector>
            <targetReference>ErrorGetNotificationScreen</targetReference>
        </connector>
        <inputAssignments>
            <field>Message__c</field>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source_Class__c</field>
            <value>
                <stringValue>ZDA Case Escalation Screen</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source_Method__c</field>
            <value>
                <stringValue>Recuperar Notificación</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Throwing_Time__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <object>Error_Log__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Crea un registro de log erroneo con el error producido al enviar la notificacion custom</description>
        <name>CreateRecordsSendNotificationErrorAction</name>
        <label>Create record send notification error</label>
        <locationX>1018</locationX>
        <locationY>3902</locationY>
        <connector>
            <targetReference>ErrorSendNotificationScreen</targetReference>
        </connector>
        <inputAssignments>
            <field>Message__c</field>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source_Class__c</field>
            <value>
                <stringValue>ZDA Case Escalation Screen</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source_Method__c</field>
            <value>
                <stringValue>Enviar Notificación</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Throwing_Time__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <object>Error_Log__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Inserta el objeto para que tenga asignado un identificador</description>
        <name>CreateSendInfoObjectAction</name>
        <label>Create send info object</label>
        <locationX>2822</locationX>
        <locationY>2630</locationY>
        <connector>
            <targetReference>SendDocCanalUnicoAction</targetReference>
        </connector>
        <inputReference>SendDocInfoObject</inputReference>
    </recordCreates>
    <recordCreates>
        <description>Crea una tarea para el usuario al que se escalará el caso</description>
        <name>CreateTaskAction</name>
        <label>Create task</label>
        <locationX>666</locationX>
        <locationY>2846</locationY>
        <assignRecordIdToReference>NewTaskId</assignRecordIdToReference>
        <connector>
            <targetReference>UpdateCase_pending_support</targetReference>
        </connector>
        <faultConnector>
            <targetReference>CreateTaskErrorAction</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>CommentsSelected</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>TaskOwnerIdVar</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <elementReference>TaskStatus</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <stringValue>Escalado de caso</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subtype__c</field>
            <value>
                <elementReference>ScalationSelected</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Type</field>
            <value>
                <stringValue>Scaled Case</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WhatId</field>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </inputAssignments>
        <object>Task</object>
    </recordCreates>
    <recordCreates>
        <description>Crea un registro de log erroneo con el error producido al crear la tarea</description>
        <name>CreateTaskErrorAction</name>
        <label>Create task error</label>
        <locationX>1810</locationX>
        <locationY>2954</locationY>
        <connector>
            <targetReference>TaskErrorScreen</targetReference>
        </connector>
        <inputAssignments>
            <field>Message__c</field>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source_Class__c</field>
            <value>
                <stringValue>ZDA Case Escalation Screen</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source_Method__c</field>
            <value>
                <stringValue>Crear tarea para el caso escalado</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Throwing_Time__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <object>Error_Log__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Crea un registro de log erroneo con el error producido al actualizar el caso</description>
        <name>UpdateCaseErrorAction</name>
        <label>Update case error</label>
        <locationX>1546</locationX>
        <locationY>3062</locationY>
        <connector>
            <targetReference>CaseErrorScreen</targetReference>
        </connector>
        <inputAssignments>
            <field>Message__c</field>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source_Class__c</field>
            <value>
                <stringValue>ZDA Case Escalation Screen</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source_Method__c</field>
            <value>
                <stringValue>Actualizar el caso a pendiente</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Throwing_Time__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <object>Error_Log__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <description>Se obtienen los adjuntos para validar su tamaño total</description>
        <name>GetAttachedFilesAction</name>
        <label>Get attached files</label>
        <locationX>1029</locationX>
        <locationY>1790</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>ResetAttachedFileSizeVariableAssignment</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ContentDocumentId</field>
            <operator>In</operator>
            <value>
                <elementReference>UploadedFileList</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ContentVersion</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>ContentSize</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Hace una query sobre usuarios filtrando por el rol de agente zda (ZDA_Agente)</description>
        <name>GetAvailableDepartmentsAction</name>
        <label>Get available departments</label>
        <locationX>1029</locationX>
        <locationY>458</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>RemoveDuplicatesAction</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>UserRoleId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>GetZDARoleIdAction.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>User</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Department</queriedFields>
        <sortField>Department</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Obtención del custom metadata donde se definen los tipos de ficheros disponibles para adjuntar</description>
        <name>GetAvailableFileTypesToAttachAction</name>
        <label>Get available file types to attach</label>
        <locationX>1029</locationX>
        <locationY>974</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AvailableFileListToTextLoop</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AllowedInZDA__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>FileMimeType__mdt</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Label</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Se obtiene de BDD el caso a escalar</description>
        <name>GetCaseAction</name>
        <label>Get scalation case</label>
        <locationX>539</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AllowScalationDecision</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Case</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Obtiene el identificador de la notificacion custom de escalado de caso</description>
        <name>GetCustomNotificationAction</name>
        <label>Get custom notification</label>
        <locationX>754</locationX>
        <locationY>3686</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>SendCustomNotificationAction</targetReference>
        </connector>
        <faultConnector>
            <targetReference>CreateRecordsGetNotificationErrorAction</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>EscalationCaseNotificacion</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>CustomNotificationType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Obtiene los responsables asociados de aquellos usuarios de ZDA</description>
        <name>GetManagersAction</name>
        <label>Get managers</label>
        <locationX>2426</locationX>
        <locationY>2522</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>UserListToManagerIdListLoop</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Department</field>
            <operator>In</operator>
            <value>
                <elementReference>DepartmentList</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>User</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>ManagerId</queriedFields>
        <sortField>ManagerId</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Obtiene la informacion de los supervisores</description>
        <name>GetManagersInfoAction</name>
        <label>Get managers info</label>
        <locationX>2558</locationX>
        <locationY>3230</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>SupervisorSelectionScreen</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>In</operator>
            <value>
                <elementReference>ManagerIdList</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>User</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Obtiene el identificador del rol para el agente ZDA (ZDA_Agente)</description>
        <name>GetZDARoleIdAction</name>
        <label>Get ZDA Role Id</label>
        <locationX>1029</locationX>
        <locationY>350</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>GetAvailableDepartmentsAction</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ZDA_AGENT_ROLE_DEVELOPER_NAME</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>UserRole</object>
        <queriedFields>Id</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <description>Establece el estado del caso como pendiente de soporte</description>
        <name>UpdateCase_pending_support</name>
        <label>Set case pending support</label>
        <locationX>666</locationX>
        <locationY>2954</locationY>
        <connector>
            <targetReference>CreateDocumentLinksLoop</targetReference>
        </connector>
        <faultConnector>
            <targetReference>UpdateCaseErrorAction</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>PendingBy__c</field>
            <value>
                <elementReference>PendingByVar</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Pendiente</stringValue>
            </value>
        </inputAssignments>
        <object>Case</object>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <screens>
        <description>Pantalla para seleccionar al agente al que irá escalado el caso</description>
        <name>AgentSelectionScreen</name>
        <label>Agent selection screen</label>
        <locationX>666</locationX>
        <locationY>2630</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>SupportDataAssignment</targetReference>
        </connector>
        <fields>
            <name>AgentSelectionInput</name>
            <choiceReferences>AvailableUsersForDepartment</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Agente</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla para visualizar el error producido al actualizar el caso</description>
        <name>CaseErrorScreen</name>
        <label>Case error screen</label>
        <locationX>1546</locationX>
        <locationY>3170</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>CaseErrorDisplay</name>
            <fieldText>&lt;p&gt;{!$Flow.FaultMessage}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla para visualizar el error producido al obtener la notificacion custom</description>
        <name>ErrorGetNotificationScreen</name>
        <label>Error get notification screen</label>
        <locationX>1282</locationX>
        <locationY>3902</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>GetCustomNotificationErrorDisplay</name>
            <fieldText>&lt;p&gt;{!$Flow.FaultMessage}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla para visualizar el error producido al enviar la notificacion custom</description>
        <name>ErrorSendNotificationScreen</name>
        <label>Error send notification screen</label>
        <locationX>1018</locationX>
        <locationY>4010</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>SendCustomNotificationErrorDisplay</name>
            <fieldText>&lt;p&gt;{!$Flow.FaultMessage}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Selección del tipo de escalado e introducción de datos</description>
        <name>EscalationDataWithPartnerScreen</name>
        <label>Scalation data with partner</label>
        <locationX>897</locationX>
        <locationY>1490</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>ScalationWithPartnerDataAssignment</targetReference>
        </connector>
        <fields>
            <name>SupportSupervisorPartnerInput</name>
            <choiceReferences>SupportChoice</choiceReferences>
            <choiceReferences>PartnerChoice</choiceReferences>
            <choiceReferences>SupervisorChoice</choiceReferences>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>ScalationSelected</elementReference>
            </defaultValue>
            <fieldText>Tipo de escalado</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>CommentsWithPartnerInput</name>
            <defaultValue>
                <stringValue>{!CommentsSelected}</stringValue>
            </defaultValue>
            <fieldText>Comentarios (máximo 1.000 caracteres)</fieldText>
            <fieldType>LargeTextArea</fieldType>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;El tamaño no puede exceder los 1.000 caracteres&lt;/p&gt;</errorMessage>
                <formulaExpression>LEN({!CommentsWithPartnerInput})&lt;1000</formulaExpression>
            </validationRule>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>SupportSupervisorPartnerInput</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>ErrorFileSizeScreenPartnerDisplay</name>
            <fieldText>&lt;p&gt;&lt;strong style=&quot;color: rgb(255, 0, 0);&quot;&gt;Se ha excedido del tamaño máximo de adjuntos admitido&lt;/strong&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>YesFileSizeExceededOutcome</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <booleanValue>true</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>AttachFilesWithPartnerInput</name>
            <extensionName>forceContent:fileUpload</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>label</name>
                <value>
                    <stringValue>Adjuntar fichero/s (el tamaño total de los adjuntos no puede superar los 2Mb)</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>multiple</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>title</name>
                <value>
                    <stringValue>Si se desea adjuntar más de un archivo, se deben adjuntar todos al mismo tiempo</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>accept</name>
                <value>
                    <elementReference>AllowedFileTypes</elementReference>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>SupportSupervisorPartnerInput</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>ShowFileNamesWIthPartnerDisplay</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Ficheros adjuntos:&lt;/strong&gt; {!AttachFilesWithPartnerInput.fileNames}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>AttachFilesWithPartnerInput.fileNames</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla para informar de que no hay supervisores disponibles</description>
        <name>NoAvailableManagersScreen</name>
        <label>No available managers screen</label>
        <locationX>2294</locationX>
        <locationY>3230</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>NoSupervisorsDisplay</name>
            <fieldText>&lt;p&gt;No se han encontrado usuarios con el supervisor definido&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>NoManagersAvailableOutcome</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <booleanValue>true</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla que se muestra por no permitir escalar el caso en determinados estados</description>
        <name>NotAllowedScalationScreen</name>
        <label>Escalado no permitido</label>
        <locationX>50</locationX>
        <locationY>350</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>NoAllowedScalationDisplay</name>
            <fieldText>&lt;p&gt;No se permite el escalado de casos en estado nuevo o cerrado&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Selección del tipo de escalado e introducción de datos</description>
        <name>ScalationDataWithoutPartnerScreen</name>
        <label>Scalation data without partner</label>
        <locationX>1161</locationX>
        <locationY>1490</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>ScalationWithoutPartnerDataAssignment</targetReference>
        </connector>
        <fields>
            <name>SupportSupervisorInput</name>
            <choiceReferences>SupportChoice</choiceReferences>
            <choiceReferences>SupervisorChoice</choiceReferences>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>ScalationSelected</elementReference>
            </defaultValue>
            <fieldText>Tipo de escalado</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>CommentsWithoutPartnerInput</name>
            <defaultValue>
                <stringValue>{!CommentsSelected}</stringValue>
            </defaultValue>
            <fieldText>Comentarios (máximo 1.000 caracteres)</fieldText>
            <fieldType>LargeTextArea</fieldType>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;El tamaño no puede exceder los 1.000 caracteres&lt;/p&gt;</errorMessage>
                <formulaExpression>LEN({!CommentsWithoutPartnerInput})&lt;1000</formulaExpression>
            </validationRule>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>SupportSupervisorInput</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>ErrorFileSizeScreenNoPartnerDisplay</name>
            <fieldText>&lt;p&gt;&lt;strong style=&quot;color: rgb(255, 0, 0); background-color: rgb(255, 255, 255);&quot;&gt;Se ha excedido del tamaño máximo de adjuntos admitido&lt;/strong&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>YesFileSizeExceededOutcome</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <booleanValue>true</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>AttachFilesWithoutPartnerInput</name>
            <extensionName>forceContent:fileUpload</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>label</name>
                <value>
                    <stringValue>Adjuntar fichero/s (el tamaño total de los adjuntos no puede superar los 2Mb)</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>multiple</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>title</name>
                <value>
                    <stringValue>Si se desea adjuntar más de un archivo, se deben adjuntar todos al mismo tiempo</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>accept</name>
                <value>
                    <elementReference>AllowedFileTypes</elementReference>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>SupportSupervisorInput</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>ShowFileNamesWIthoutPartnerDisplay</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Ficheros adjuntos: &lt;/strong&gt;{!AttachFilesWithoutPartnerInput.fileNames}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>AttachFilesWithoutPartnerInput.fileNames</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla final del flujo</description>
        <name>ScalingSucceededScreen</name>
        <label>Scaling succeeded</label>
        <locationX>666</locationX>
        <locationY>4334</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>ScalingOKDisplay</name>
            <fieldText>&lt;p&gt;Escalado realizado correctamente&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla para seleccionar al supervisor al que escalar el caso</description>
        <name>SupervisorSelectionScreen</name>
        <label>Supervisor selection screen</label>
        <locationX>2558</locationX>
        <locationY>3338</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>SupervisorDataAssignment</targetReference>
        </connector>
        <fields>
            <name>SupervisorSelectionInput</name>
            <choiceReferences>AvailableManagersCollectionChoiceSet</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Supervisor</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla para visualizar el error producido al crear la tarea</description>
        <name>TaskErrorScreen</name>
        <label>Task error screen</label>
        <locationX>1810</locationX>
        <locationY>3062</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>TaskErrorDisplay</name>
            <fieldText>&lt;p&gt;{!$Flow.FaultMessage}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla para seleccionar al equipo al que irá escalado el caso</description>
        <name>TeamSelectionScreen</name>
        <label>Team selection screen</label>
        <locationX>666</locationX>
        <locationY>2522</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>AgentSelectionScreen</targetReference>
        </connector>
        <fields>
            <name>DepartmentSelectionInput</name>
            <choiceReferences>AvailableDepartmentsChoiceSet</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Equipo</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>413</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>GetCaseAction</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <description>Contendra las extensiones admitidas para adjuntar</description>
        <name>AllowedFileTypes</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Comentarios introducidos por el agente para el escalado</description>
        <name>CommentsSelected</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Lista de elementos content document link a crear</description>
        <name>ContentDocumentLinkListToCreate</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <description>Elemento content document link a crear</description>
        <name>ContentDocumentLinkToCreate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <description>Lista de departamentos existentes para los usuarios de ZDA</description>
        <name>DepartmentList</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Lista de identificadores de supervisores</description>
        <name>ManagerIdList</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Identificador de la tarea creada</description>
        <name>NewTaskId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Lista que contendra los identificadores de las personas que recibiran la notificacion custom</description>
        <name>NotificationRecipientsList</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Variable que contendrá el valor a asignar al campo pending by del caso</description>
        <name>PendingByVar</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Identificador del caso a escalar</description>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Tipo de escalado seleccionado</description>
        <name>ScalationSelected</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Objeto envio de documentacion a crear y adjuntar a la peticion</description>
        <name>SendDocInfoObject</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>SendDocCUInfo__c</objectType>
    </variables>
    <variables>
        <description>Parte inicial del cuerpo de la notificación custom</description>
        <name>TaskBodyStart</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>Se le ha escalado el caso: </stringValue>
        </value>
    </variables>
    <variables>
        <description>Variable que contendrá el propietario de la tarea a crear</description>
        <name>TaskOwnerIdVar</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Estado de la tarea. Sera asignado excepto para Partner, que será Cerrada</description>
        <name>TaskStatus</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>Asignada</stringValue>
        </value>
    </variables>
    <variables>
        <description>Contendra el tamaño del total de archivos adjuntados</description>
        <name>TotalFileSizeAttached</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <description>Lista de content document id de los ficheros que el agente ha adjuntado</description>
        <name>UploadedFileList</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
