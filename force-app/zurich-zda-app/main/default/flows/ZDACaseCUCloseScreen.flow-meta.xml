<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Hace la peticion a canal unico (asincrono) con la peticion del cierre del caso</description>
        <name>SendDocCanalUnicoAction</name>
        <label>Send close action</label>
        <locationX>446</locationX>
        <locationY>2438</locationY>
        <actionName>SendDocCanalUnicoAction</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>CloseSucceededScreen</targetReference>
        </connector>
        <flowTransactionModel>Automatic</flowTransactionModel>
        <inputParameters>
            <name>sendDocObject</name>
            <value>
                <elementReference>sendInfoObject</elementReference>
            </value>
        </inputParameters>
        <nameSegment>SendDocCanalUnicoAction</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>60.0</apiVersion>
    <assignments>
        <description>Crea y asigna el nuevo link</description>
        <name>AddContentDocumentLinkAssignment</name>
        <label>Add content document link</label>
        <locationX>534</locationX>
        <locationY>2030</locationY>
        <assignmentItems>
            <assignToReference>ContentDocumentLinkToCreate.ContentDocumentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CreateDocumentLinksLoop.ContentDocumentId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContentDocumentLinkToCreate.LinkedEntityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContentDocumentLinkToCreate.ShareType</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>V</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContentDocumentLinkToCreate.Visibility</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>AllUsers</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ContentDocLinkToCreateList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ContentDocumentLinkToCreate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CreateDocumentLinksLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Agrega a la variable de las extensiones permitidas la actual del bucle</description>
        <name>AddFileExtensionAssignment</name>
        <label>Add file extension</label>
        <locationX>138</locationX>
        <locationY>566</locationY>
        <assignmentItems>
            <assignToReference>AllowedFileTypes</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>FileExtensionWithPointFormula</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AvailableFileListToTextLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Suma el tamaño del fichero actual al total</description>
        <name>AddFileSizeAssignment</name>
        <label>Add file size</label>
        <locationX>358</locationX>
        <locationY>1298</locationY>
        <assignmentItems>
            <assignToReference>TotalFileSizeAttached</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>AttachedFilesSizeLoop.ContentSize</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AttachedFilesSizeLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Pone a 0 la variable que contiene el tamaño total de archivos adjuntos</description>
        <name>ResetAttachedFileSizeVariableAssignment</name>
        <label>Reset attached file size variable</label>
        <locationX>270</locationX>
        <locationY>1082</locationY>
        <assignmentItems>
            <assignToReference>TotalFileSizeAttached</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CommentsSelected</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ResponseInput</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AttachedFilesSizeLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Informar el objeto de envio a crear</description>
        <name>SendDocObjectCreationAssignment</name>
        <label>Send doc object creation</label>
        <locationX>446</locationX>
        <locationY>1814</locationY>
        <assignmentItems>
            <assignToReference>sendInfoObject.CaseId__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>sendInfoObject.Comments__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GetCaseAction.ResponseCanalUnico__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>sendInfoObject.ContentDocIds__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ContentDocIdListString</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CreateDocumentLinksLoop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Establece los datos del cierre en el caso que se va a actualizar</description>
        <name>SetCaseCloseDataAssignment</name>
        <label>Set case close data</label>
        <locationX>446</locationX>
        <locationY>1598</locationY>
        <assignmentItems>
            <assignToReference>GetCaseAction.ResponseCanalUnico__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CommentsSelected</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>GetCaseAction.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Cerrado</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>GetCaseAction.ReasonId__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <connector>
            <targetReference>UpdateCaseAction</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Permitir el cierre del caso. Solo sera posible si es de tipo ZDA, origen canal unico, el status es asignado, respondido o pendiente de partner y el caso esta tipificado</description>
        <name>AllowCloseDecision</name>
        <label>Allow close</label>
        <locationX>380</locationX>
        <locationY>242</locationY>
        <defaultConnector>
            <targetReference>NotAllowedCloseScreen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>AllowCloseOutcome</name>
            <conditionLogic>1 AND 2 AND (3 OR 4 OR (5 AND 6)) AND 7 AND 8 AND 9</conditionLogic>
            <conditions>
                <leftValueReference>GetCaseAction.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>ZDARecordTypeName</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.Origin</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>CanalUnico</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Asignado</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Respondido</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Pendiente</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.PendingBy__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Partner</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.Type</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.Subtype__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetCaseAction.TypeN3__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetAvailableFileTypesToAttachAction</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Comprobar que el resultado de cierre no sea nulo</description>
        <name>Close_Result_Null</name>
        <label>Close Result Null</label>
        <locationX>50</locationX>
        <locationY>866</locationY>
        <defaultConnector>
            <targetReference>GetAttachedFilesAction</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>NullCloseResult</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetCaseAction.CloseResult__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>CloseCaseDataScreen</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se comprueba si el tamaño maximo ha sido excedido</description>
        <name>MaxFileSizeExceededDecision</name>
        <label>Max file size exceeded</label>
        <locationX>270</locationX>
        <locationY>1490</locationY>
        <defaultConnector>
            <targetReference>SetCaseCloseDataAssignment</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesFileSizeExceededOutcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>TotalFileSizeAttached</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <elementReference>MaxAllowedAttachedBytes</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>CloseCaseDataScreen</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <description>Screen flow para el cierre de casos de ZDA provenientes de canal único</description>
    <environments>Default</environments>
    <formulas>
        <description>Lista de identificadores de ficheros adjuntos</description>
        <name>ContentDocIdListString</name>
        <dataType>String</dataType>
        <expression>{!AttachFilesInput.contentDocIds}</expression>
    </formulas>
    <formulas>
        <description>Extension del fichero concatenando un punto por delante y una coma por detras para construir el string de tipos de fichero admitidos</description>
        <name>FileExtensionWithPointFormula</name>
        <dataType>String</dataType>
        <expression>&quot;.&quot;&amp;{!AvailableFileListToTextLoop.Label}&amp;&quot;,&quot;</expression>
    </formulas>
    <formulas>
        <description>Label para los ficheros adjuntados</description>
        <name>LabelAttachedFiles</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE({!$Label.ZDAAttachedFileNamesLbl}, &apos;#attachedFileNames#&apos;, {!AttachFilesInput.fileNames})</expression>
    </formulas>
    <formulas>
        <description>Label para el hover del input files</description>
        <name>LabelHoverInputFile</name>
        <dataType>String</dataType>
        <expression>{!$Label.ZDAHoverAttachmentsMsg}</expression>
    </formulas>
    <formulas>
        <description>Label para el input de ficheros</description>
        <name>LabelInputFile</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE({!$Label.ZDAMaxAttachmentSizeMsg}, &apos;#fileSizeReplacement#&apos;, TEXT({!MaxAllowedAttachedMb}))</expression>
    </formulas>
    <formulas>
        <description>Tamaño maximo permitido en los adjuntos (definido en bytes)</description>
        <name>MaxAllowedAttachedBytes</name>
        <dataType>Number</dataType>
        <expression>VALUE({!$CustomMetadata.Global_Configuration__mdt.MaxAttachedBytesSendCU.Value__c})</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <description>Tamaño maximo de los adjuntos en Mb</description>
        <name>MaxAllowedAttachedMb</name>
        <dataType>Number</dataType>
        <expression>{!MaxAllowedAttachedBytes} / 1024 /1024</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <description>Numero maximo de caracteres permitido en la respuesta</description>
        <name>MaxAllowedChars</name>
        <dataType>Number</dataType>
        <expression>VALUE({!$CustomMetadata.Global_Configuration__mdt.MaxCharacterSendCU.Value__c})</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <description>Developer name del recordtype del caso ZDA</description>
        <name>ZDARecordTypeName</name>
        <dataType>String</dataType>
        <expression>{!$CustomMetadata.Global_Configuration__mdt.Case_RecordType_ZDA.Value__c}</expression>
    </formulas>
    <interviewLabel>ZDA - Close CU Case {!$Flow.CurrentDateTime}</interviewLabel>
    <label>ZDA - Case CU close screen</label>
    <loops>
        <description>Bucle para calcular el tamaño total de los adjuntos</description>
        <name>AttachedFilesSizeLoop</name>
        <label>Attached files size</label>
        <locationX>270</locationX>
        <locationY>1190</locationY>
        <collectionReference>GetAttachedFilesAction</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AddFileSizeAssignment</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>MaxFileSizeExceededDecision</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Pasar de una lista de extensiones de fichero validas a un string</description>
        <name>AvailableFileListToTextLoop</name>
        <label>Available file list to text</label>
        <locationX>50</locationX>
        <locationY>458</locationY>
        <collectionReference>GetAvailableFileTypesToAttachAction</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AddFileExtensionAssignment</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>CloseCaseDataScreen</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Crea el link entre los ficheros adjuntos y el caso a cerrar</description>
        <name>CreateDocumentLinksLoop</name>
        <label>Create document links loop</label>
        <locationX>446</locationX>
        <locationY>1922</locationY>
        <collectionReference>GetAttachedFilesAction</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AddContentDocumentLinkAssignment</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>CreateContentDocumentLinksAction</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <description>Crea la lista de content document links para asociar los adjuntos con la tarea creada</description>
        <name>CreateContentDocumentLinksAction</name>
        <label>Create content document links</label>
        <locationX>446</locationX>
        <locationY>2222</locationY>
        <connector>
            <targetReference>CreateSendObjectAction</targetReference>
        </connector>
        <inputReference>ContentDocLinkToCreateList</inputReference>
    </recordCreates>
    <recordCreates>
        <description>Inserta el objeto para que tenga asignado un identificador</description>
        <name>CreateSendObjectAction</name>
        <label>Create send object</label>
        <locationX>446</locationX>
        <locationY>2330</locationY>
        <connector>
            <targetReference>SendDocCanalUnicoAction</targetReference>
        </connector>
        <inputReference>sendInfoObject</inputReference>
    </recordCreates>
    <recordLookups>
        <description>Se obtienen los adjuntos para validar su tamaño total</description>
        <name>GetAttachedFilesAction</name>
        <label>Get attached files</label>
        <locationX>270</locationX>
        <locationY>974</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>ResetAttachedFileSizeVariableAssignment</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ContentDocumentId</field>
            <operator>In</operator>
            <value>
                <elementReference>AttachFilesInput.contentDocIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ContentVersion</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>ContentSize</queriedFields>
        <queriedFields>ContentDocumentId</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Obtención del custom metadata donde se definen los tipos de ficheros disponibles para adjuntar</description>
        <name>GetAvailableFileTypesToAttachAction</name>
        <label>Get available file types to attach</label>
        <locationX>50</locationX>
        <locationY>350</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AvailableFileListToTextLoop</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AllowedInZDA__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>FileMimeType__mdt</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Label</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Se obtiene el caso que se va a cerrar</description>
        <name>GetCaseAction</name>
        <label>Get case</label>
        <locationX>380</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AllowCloseDecision</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Case</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <description>Actualiza el caso para cerrarlo</description>
        <name>UpdateCaseAction</name>
        <label>Update case</label>
        <locationX>446</locationX>
        <locationY>1706</locationY>
        <connector>
            <targetReference>SendDocObjectCreationAssignment</targetReference>
        </connector>
        <inputReference>GetCaseAction</inputReference>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <screens>
        <description>Selección de los datos para el cierre y envío a Canal único</description>
        <name>CloseCaseDataScreen</name>
        <label>Close case data</label>
        <locationX>50</locationX>
        <locationY>758</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Close_Result_Null</targetReference>
        </connector>
        <fields>
            <fieldType>ObjectProvided</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
            <objectFieldReference>GetCaseAction.Subtype__c</objectFieldReference>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>recordId</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>true</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <fieldType>ObjectProvided</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
            <objectFieldReference>GetCaseAction.CloseResult__c</objectFieldReference>
        </fields>
        <fields>
            <name>ErrorCloseResultNull</name>
            <fieldText>&lt;p&gt;&lt;strong style=&quot;background-color: rgb(255, 255, 255); color: rgb(255, 0, 0);&quot;&gt;El campo Resultado de Cierre no puede estar vacío.&lt;/strong&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>GetCaseAction.CloseResult__c</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>true</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>ResponseInput</name>
            <defaultValue>
                <stringValue>{!CommentsSelected}</stringValue>
            </defaultValue>
            <fieldText>Respuesta canal único (máximo {!MaxAllowedChars} caracteres)</fieldText>
            <fieldType>LargeTextArea</fieldType>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;El tamaño no puede exceder los &lt;/span&gt;{!MaxAllowedChars}&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt; caracteres&lt;/span&gt;&lt;/p&gt;</errorMessage>
                <formulaExpression>LEN({!ResponseInput})&lt;{!MaxAllowedChars}</formulaExpression>
            </validationRule>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>GetCaseAction.CloseResult__c</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>ErrorFileSizeScreenPartnerDisplay</name>
            <fieldText>&lt;p&gt;&lt;strong style=&quot;color: rgb(255, 0, 0); background-color: rgb(255, 255, 255);&quot;&gt;{!$Label.ZDAErrorMaxAttachmentExceededMsg}&lt;/strong&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>YesFileSizeExceededOutcome</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <booleanValue>true</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>AttachFilesInput</name>
            <extensionName>forceContent:fileUpload</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>label</name>
                <value>
                    <elementReference>LabelInputFile</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>accept</name>
                <value>
                    <elementReference>AllowedFileTypes</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>multiple</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>title</name>
                <value>
                    <elementReference>LabelHoverInputFile</elementReference>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>GetCaseAction.CloseResult__c</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>ShowFileNamesDisplay</name>
            <fieldText>&lt;p&gt;{!LabelAttachedFiles}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>AttachFilesInput.fileNames</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
                <conditions>
                    <leftValueReference>GetCaseAction.CloseResult__c</leftValueReference>
                    <operator>IsNull</operator>
                    <rightValue>
                        <booleanValue>false</booleanValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla final del flujo</description>
        <name>CloseSucceededScreen</name>
        <label>Close succeeded</label>
        <locationX>446</locationX>
        <locationY>2546</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>CloseOKDisplay</name>
            <fieldText>&lt;p&gt;Cierre del caso realizado correctamente&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Pantalla que se muestra por no permitir cerrar el caso</description>
        <name>NotAllowedCloseScreen</name>
        <label>Cierre no permitido</label>
        <locationX>710</locationX>
        <locationY>350</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>NoAllowedCloseDisplay</name>
            <fieldText>&lt;p&gt;{!$Label.ZDACloseCaseFlowNotAllowedMsg}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>254</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>GetCaseAction</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <description>Contendra las extensiones admitidas para adjuntar</description>
        <name>AllowedFileTypes</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Comentarios introducidos por el agente para el cierre</description>
        <name>CommentsSelected</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Lista de relaciones entre los ficheros a enviar y el caso</description>
        <name>ContentDocLinkToCreateList</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <description>Enlace entre un fichero y un caso a crear</description>
        <name>ContentDocumentLinkToCreate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <description>Identificador del caso a cerrar</description>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Objeto de envio a canal unico a crear</description>
        <name>sendInfoObject</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>SendDocCUInfo__c</objectType>
    </variables>
    <variables>
        <description>Contendra el tamaño del total de archivos adjuntados</description>
        <name>TotalFileSizeAttached</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
</Flow>
