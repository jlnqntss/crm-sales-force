<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Se procede con el envío de la Nota INFO a Genesys Cloud.</description>
        <name>genesysCloudRouteMessageAction</name>
        <label>Enrutar mensaje a Genesys Cloud</label>
        <locationX>1964</locationX>
        <locationY>1524</locationY>
        <actionName>GenesysCloudRouteMessageAction</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>GetInteractionRecordTypeIdAction</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>caseSla</name>
            <value>
                <elementReference>PriorityCalculationSubflow.calculatedSla</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>flowId</name>
            <value>
                <elementReference>genesysFlowId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fromAddress</name>
            <value>
                <elementReference>$Record.SuppliedEmail</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>fromName</name>
            <value>
                <elementReference>$Record.SuppliedName</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>industrySpecializationType</name>
            <value>
                <elementReference>SpecializationType</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>ownerId</name>
            <value>
                <elementReference>GestorPreferenteSearchFromEmailSubflow.GestorPreferenteAsignado</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>queueIdAttribute</name>
            <value>
                <elementReference>genesysQueueName</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>screenPopRecordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subject</name>
            <value>
                <elementReference>$Record.Subject</elementReference>
            </value>
        </inputParameters>
        <nameSegment>GenesysCloudRouteMessageAction</nameSegment>
        <outputParameters>
            <assignToReference>interactionId</assignToReference>
            <name>interactionId</name>
        </outputParameters>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>53.0</apiVersion>
    <assignments>
        <name>Asignamos_variables_generico</name>
        <label>Asignamos variables generico</label>
        <locationX>1262</locationX>
        <locationY>600</locationY>
        <assignmentItems>
            <assignToReference>genesysQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GetGenesysCloudQueueAction.genesysQueueId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>genesysQueueName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GetGenesysCloudQueueAction.genesysQueueName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>genesysFlowId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GetGenesysCloudQueueAction.genesysFlowId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>GetGenesysQueueAction</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Asignamos_variables_Intermediary</name>
        <label>Asignamos variables Intermediary</label>
        <locationX>998</locationX>
        <locationY>600</locationY>
        <assignmentItems>
            <assignToReference>genesysQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Obtener_cola_de_Genesys_Cloud_desde_Intermediary.genesysQueueId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>genesysQueueName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Obtener_cola_de_Genesys_Cloud_desde_Intermediary.genesysQueueName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>genesysFlowId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Obtener_cola_de_Genesys_Cloud_desde_Intermediary.genesysFlowId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>GetGenesysQueueAction</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Modificar_variables_cola</name>
        <label>Modificar variables cola</label>
        <locationX>1832</locationX>
        <locationY>1224</locationY>
        <assignmentItems>
            <assignToReference>genesysFlowId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GestorPreferenteSearchFromEmailSubflow.genesysFlowId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>genesysQueueName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GestorPreferenteSearchFromEmailSubflow.genesysQueueName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>genesysQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GestorPreferenteSearchFromEmailSubflow.genesysQueueId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>PriorityCalculationSubflow</targetReference>
        </connector>
    </assignments>
    <constants>
        <description>Nombre API del tipo de registro Task: Interaction</description>
        <name>RECORDTYPE_INTERACTION</name>
        <dataType>String</dataType>
        <value>
            <stringValue>Interaction</stringValue>
        </value>
    </constants>
    <decisions>
        <name>Cambia_de_cola_para_enrutar_a_genesys</name>
        <label>¿Cambia de cola para enrutar a genesys?</label>
        <locationX>1964</locationX>
        <locationY>1116</locationY>
        <defaultConnector>
            <targetReference>PriorityCalculationSubflow</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>NuevaCola</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GestorPreferenteSearchFromEmailSubflow.genesysFlowId</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GestorPreferenteSearchFromEmailSubflow.genesysQueueName</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Modificar_variables_cola</targetReference>
            </connector>
            <label>Si</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Origin</name>
        <label>Check Origin</label>
        <locationX>1964</locationX>
        <locationY>1740</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Origin_NotaInfo</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Origin</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>NoteINFO</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>getSalesforceQueue</targetReference>
            </connector>
            <label>Origin NotaInfo</label>
        </rules>
        <rules>
            <name>Origin_Web</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Origin</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Web</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CreateTaskWebMiZurichAction</targetReference>
            </connector>
            <label>Origin Web</label>
        </rules>
        <rules>
            <name>Origin_Canal_Unico</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Origin</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>CanalUnico</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Queue_To_Update_Owner</targetReference>
            </connector>
            <label>Origin Canal Unico</label>
        </rules>
    </decisions>
    <decisions>
        <name>Es_caso_hijo_USP</name>
        <label>¿Es caso hijo USP?</label>
        <locationX>814</locationX>
        <locationY>1956</locationY>
        <defaultConnector>
            <targetReference>Es_mediador_panelizado_de_venta_da_os_rc</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Caso_hijo_USP</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Case_RecordType_USP</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.ParentId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CreateTaskAction</targetReference>
            </connector>
            <label>Caso hijo USP</label>
        </rules>
    </decisions>
    <decisions>
        <name>Es_mediador_panelizado_de_venta_da_os_rc</name>
        <label>¿Es mediador panelizado de venta daños rc?</label>
        <locationX>1067</locationX>
        <locationY>2064</locationY>
        <defaultConnector>
            <targetReference>Update_case_owner</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Es_mediador_Panelizado</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Case_RecordType_USP</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GestorPreferenteSearchFromEmailSubflow.EsMediadorPanelizadoVentaDanosRC</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Obtener_Usuario_Panelizado</targetReference>
            </connector>
            <label>Es mediador Panelizado</label>
        </rules>
    </decisions>
    <decisions>
        <name>Hay_que_actualizar_best_agent</name>
        <label>¿Hay que actualizar best agent?</label>
        <locationX>2453</locationX>
        <locationY>1956</locationY>
        <defaultConnector>
            <targetReference>Actualizar_owner</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Actualizar_best_agent</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GestorPreferenteSearchFromEmailSubflow.GestorPreferente</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Actualizar_caso</targetReference>
            </connector>
            <label>Actualizar best agent</label>
        </rules>
    </decisions>
    <decisions>
        <description>Comprobamos si la cuenta asociada al caso es de tipo intermediario, ya que en caso afirmativo habrá que enviar más información al sistema de enrutado</description>
        <name>Is_Intermediary_Account</name>
        <label>Is Intermediary Account?</label>
        <locationX>1130</locationX>
        <locationY>384</locationY>
        <defaultConnector>
            <targetReference>GetGenesysCloudQueueAction</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Account.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Intermediary</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.AccountId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Obtener_cola_de_Genesys_Cloud_desde_Intermediary</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>IsUSPAndClosedDecision</name>
        <label>Is USP and Closed?</label>
        <locationX>582</locationX>
        <locationY>276</locationY>
        <defaultConnector>
            <targetReference>Is_Intermediary_Account</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>YesClosedOutcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cerrado</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>USPInquiry</stringValue>
                </rightValue>
            </conditions>
            <label>Yes Closed</label>
        </rules>
    </decisions>
    <decisions>
        <name>ResponsableNegocioEncontradoDecision</name>
        <label>¿Responsable Negocio Encontrado?</label>
        <locationX>1130</locationX>
        <locationY>1008</locationY>
        <defaultConnector>
            <targetReference>Cambia_de_cola_para_enrutar_a_genesys</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>EncontradoOutcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GestorPreferenteSearchFromEmailSubflow.usuarioResponsableNegocio</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>USPInquiry</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>UpdateCaseOwnerAction</targetReference>
            </connector>
            <label>Encontrado</label>
        </rules>
    </decisions>
    <decisions>
        <name>Usuario_Encontrado</name>
        <label>¿Usuario Encontrado?</label>
        <locationX>869</locationX>
        <locationY>2280</locationY>
        <defaultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Update_case_owner</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Encontrado_mediador_panelizado</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Obtener_Usuario_Panelizado.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Actualizar_owner_a_usuario_panelizado</targetReference>
            </connector>
            <label>Encontrado mediador panelizado</label>
        </rules>
    </decisions>
    <description>Este flujo es ejecutado tras ser insertado un caso cuyo origen sea Nota INFO  (API: NoteINFO) o Web o Canal unico (ZDA)
Se consulta en un sub-flujo la cola a la que debe ser enrutado.
Se utiliza una acción de Apex para enviar el mensaje a Genesy sCloud.
Se registra el resultado en una tarea relacionada al caso con el identificador de la interacción en Genesys Cloud.</description>
    <environments>Default</environments>
    <formulas>
        <name>Case_RecordType_USP</name>
        <dataType>String</dataType>
        <expression>{!$CustomMetadata.Global_Configuration__mdt.Case_RecordType_USP.Value__c}</expression>
    </formulas>
    <formulas>
        <name>CSMAdministrationManager</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.CsmAdministrationManager__c})</expression>
    </formulas>
    <formulas>
        <name>CSMIndividualsManager</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.CsmIndividualsManager__c})</expression>
    </formulas>
    <formulas>
        <name>ResponsableNegocio</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.BusinessManagerEmail__c})</expression>
    </formulas>
    <formulas>
        <description>Fórmula que comprobará si el campo SpecializationType está informado</description>
        <name>SpecializationType</name>
        <dataType>String</dataType>
        <expression>IF(ISBLANK({!$Record.AccountId}), &apos;&apos;, TEXT({!$Record.Account.SpecializationType__c}))</expression>
    </formulas>
    <formulas>
        <name>SuscriptorDyO</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.SuscriptorDyO__c})</expression>
    </formulas>
    <formulas>
        <name>SuscriptorPymes</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.SuscriptorPymes__c})</expression>
    </formulas>
    <formulas>
        <name>SuscriptorRC</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.SuscriptorRC__c})</expression>
    </formulas>
    <formulas>
        <name>UWConstruccionCartera</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null,{!$Record.Account.UWPorfolioBuilding__c} )</expression>
    </formulas>
    <formulas>
        <name>UWConstruccionVenta</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.UWSaleBuilding__c})</expression>
    </formulas>
    <formulas>
        <name>UWDanosRCCartera</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.UWPortfolioRCDamage__c})</expression>
    </formulas>
    <formulas>
        <name>UWDanosRCVenta</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.UWSaleRCDamage__c})</expression>
    </formulas>
    <formulas>
        <name>UWSpecialtiesCartera</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.UWPortfolioSpecialties__c})</expression>
    </formulas>
    <formulas>
        <name>UWSpecialtiesVenta</name>
        <dataType>String</dataType>
        <expression>if(isblank({!$Record.AccountId}), null, {!$Record.Account.UWSaleSpecialties__c})</expression>
    </formulas>
    <interviewLabel>Case Trigger - After Insert - Enrutador de casos a Genesys  {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case Trigger - After Insert - Enrutador de casos a Genesys</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <description>Se registra el error en Salesforce con el detalle del mismo.</description>
        <name>CreateErrorLogAction</name>
        <label>Registrar error</label>
        <locationX>3377</locationX>
        <locationY>1740</locationY>
        <inputAssignments>
            <field>Level__c</field>
            <value>
                <stringValue>Error</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Message__c</field>
            <value>
                <elementReference>$Flow.CurrentStage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Record_Object__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Source_Class__c</field>
            <value>
                <stringValue>Case Trigger - After Insert - Enrutador de Notas INFO</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Stack_Trace__c</field>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Throwing_time__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Type_Name__c</field>
            <value>
                <elementReference>$Flow.InterviewGuid</elementReference>
            </value>
        </inputAssignments>
        <object>Error_Event__e</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Se inserta en la BBDD de Salesforce la tarea relacionada con la interacción en Genesys Cloud.</description>
        <name>CreateTaskAction</name>
        <label>Registrar tarea</label>
        <locationX>814</locationX>
        <locationY>2748</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>CreateErrorLogAction</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>CallObject</field>
            <value>
                <elementReference>interactionId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>GetInteractionRecordTypeIdAction.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>$Record.Subject</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subtype__c</field>
            <value>
                <stringValue>Note Info</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Type</field>
            <value>
                <stringValue>Email</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WhatId</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Task</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Se inserta en la BBDD de Salesforce la tarea relacionada con la interacción en Genesys Cloud.</description>
        <name>CreateTaskWebMiZurichAction</name>
        <label>Registrar tarea Web MiZurich</label>
        <locationX>1793</locationX>
        <locationY>1848</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>CreateErrorLogAction</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>CallObject</field>
            <value>
                <elementReference>interactionId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>GetInteractionRecordTypeIdAction.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>$Record.Subject</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subtype__c</field>
            <value>
                <stringValue>Incidences Record MiZurich</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Type</field>
            <value>
                <stringValue>Forms</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WhatId</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Task</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Se inserta en la BBDD de Salesforce la tarea relacionada con la interacción en Genesys Cloud.</description>
        <name>Registrar_tarea</name>
        <label>Registrar tarea</label>
        <locationX>297</locationX>
        <locationY>1332</locationY>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>ObtenerTipoRegistroUSP.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>$Record.Subject</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subtype__c</field>
            <value>
                <stringValue>Note Info</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Type</field>
            <value>
                <stringValue>Email</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WhatId</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Task</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Registrar_Tarea_CanalUnico</name>
        <label>Registrar Tarea CanalUnico</label>
        <locationX>2453</locationX>
        <locationY>2256</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>CreateErrorLogAction</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>CallObject</field>
            <value>
                <elementReference>interactionId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>GetInteractionRecordTypeIdAction.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>$Record.Subject</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subtype__c</field>
            <value>
                <stringValue>Single channel</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Type</field>
            <value>
                <stringValue>Email</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WhatId</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Task</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <name>Get_Queue_To_Update_Owner</name>
        <label>Get Queue To Update Owner</label>
        <locationX>2453</locationX>
        <locationY>1848</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Hay_que_actualizar_best_agent</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>genesysQueueName</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Group</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetGenesysQueueAction</name>
        <label>Get Genesys Queue</label>
        <locationX>1130</locationX>
        <locationY>792</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>GestorPreferenteSearchFromEmailSubflow</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>genesysQueueName</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>purecloud__PureCloud_Queue__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Se recupera el identificador del tipo de registro Task: Interaction para registrar la siguiente tarea.</description>
        <name>GetInteractionRecordTypeIdAction</name>
        <label>Obetener tipo de registro Task: Interaction</label>
        <locationX>1964</locationX>
        <locationY>1632</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_Origin</targetReference>
        </connector>
        <faultConnector>
            <targetReference>CreateErrorLogAction</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>RECORDTYPE_INTERACTION</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>RecordType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>getSalesforceQueue</name>
        <label>Get Salesforce queue</label>
        <locationX>814</locationX>
        <locationY>1848</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Es_caso_hijo_USP</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>genesysQueueName</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Group</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Obtener_Usuario_Panelizado</name>
        <label>Obtener Usuario Panelizado</label>
        <locationX>869</locationX>
        <locationY>2172</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Usuario_Encontrado</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Email</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>GestorPreferenteSearchFromEmailSubflow.GestorPreferente</elementReference>
            </value>
        </filters>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Se recupera el identificador del tipo de registro Task: Interaction para registrar la siguiente tarea.</description>
        <name>ObtenerTipoRegistroUSP</name>
        <label>Obtener tipo de registro USP</label>
        <locationX>297</locationX>
        <locationY>1224</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Registrar_tarea</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Interaction</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>RecordType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Actualizar_caso</name>
        <label>Actualizar caso</label>
        <locationX>2321</locationX>
        <locationY>2064</locationY>
        <connector>
            <targetReference>Registrar_Tarea_CanalUnico</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>BestAgent__c</field>
            <value>
                <elementReference>GestorPreferenteSearchFromEmailSubflow.GestorPreferente</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>Get_Queue_To_Update_Owner.Id</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Actualizar_owner</name>
        <label>Actualizar owner</label>
        <locationX>2585</locationX>
        <locationY>2064</locationY>
        <connector>
            <targetReference>Registrar_Tarea_CanalUnico</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>Get_Queue_To_Update_Owner.Id</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Actualizar_owner_a_usuario_panelizado</name>
        <label>Actualizar owner a usuario panelizado</label>
        <locationX>737</locationX>
        <locationY>2388</locationY>
        <connector>
            <targetReference>CreateTaskAction</targetReference>
        </connector>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>Obtener_Usuario_Panelizado.Id</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_case_owner</name>
        <label>Update case owner</label>
        <locationX>1265</locationX>
        <locationY>2172</locationY>
        <connector>
            <targetReference>CreateTaskAction</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>getSalesforceQueue.Id</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>UpdateCaseOwnerAction</name>
        <label>Update Case Owner</label>
        <locationX>297</locationX>
        <locationY>1116</locationY>
        <connector>
            <targetReference>ObtenerTipoRegistroUSP</targetReference>
        </connector>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>GestorPreferenteSearchFromEmailSubflow.usuarioResponsableNegocio.Id</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <filterLogic>1 OR (2 AND 3) OR 4</filterLogic>
        <filters>
            <field>Origin</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>NoteINFO</stringValue>
            </value>
        </filters>
        <filters>
            <field>Origin</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Web</stringValue>
            </value>
        </filters>
        <filters>
            <field>Subject</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Solicitud de ayuda al registro de MiZurich</stringValue>
            </value>
        </filters>
        <filters>
            <field>Origin</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>CanalUnico</stringValue>
            </value>
        </filters>
        <object>Case</object>
        <recordTriggerType>Create</recordTriggerType>
        <scheduledPaths>
            <connector>
                <targetReference>IsUSPAndClosedDecision</targetReference>
            </connector>
            <pathType>AsyncAfterCommit</pathType>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>GestorPreferenteSearchFromEmailSubflow</name>
        <label>Buscar Gestor Preferente</label>
        <locationX>1130</locationX>
        <locationY>900</locationY>
        <connector>
            <targetReference>ResponsableNegocioEncontradoDecision</targetReference>
        </connector>
        <flowName>EmailMessage_Comprobar_Cola_Genesys_y_ParentID</flowName>
        <inputAssignments>
            <name>ColaGenesysCallCenter</name>
            <value>
                <elementReference>GetGenesysQueueAction.CallCenter__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ColaGenesysScope</name>
            <value>
                <elementReference>GetGenesysQueueAction.Scope__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>CommercialPorductCodeCaso</name>
            <value>
                <elementReference>$Record.CommercialProductCode__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>EmailPropietarioCaso</name>
            <value>
                <elementReference>$Record.Owner:User.Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>EmailPropietarioCasoPadre</name>
            <value>
                <elementReference>$Record.Parent.Owner:User.Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>GenesysDanosQueue</name>
            <value>
                <elementReference>GetGenesysQueueAction.Name</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>idCaso</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>IdCuentaCaso</name>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>IDPropietarioCaso</name>
            <value>
                <elementReference>$Record.OwnerId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreConstruccionCartera</name>
            <value>
                <elementReference>UWConstruccionCartera</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreConstruccionVenta</name>
            <value>
                <elementReference>UWConstruccionVenta</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreCSMAdminManager</name>
            <value>
                <elementReference>CSMAdministrationManager</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreCSMIndivManager</name>
            <value>
                <elementReference>CSMIndividualsManager</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreDanosRCCartera</name>
            <value>
                <elementReference>UWDanosRCCartera</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreDanosRCVenta</name>
            <value>
                <elementReference>UWDanosRCVenta</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreSpecialtiesCartera</name>
            <value>
                <elementReference>UWSpecialtiesCartera</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreSpecialtiesVenta</name>
            <value>
                <elementReference>UWSpecialtiesVenta</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreSuscriptorDyO</name>
            <value>
                <elementReference>SuscriptorDyO</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreSuscriptorPymes</name>
            <value>
                <elementReference>SuscriptorPymes</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NombreSuscriptorRC</name>
            <value>
                <elementReference>SuscriptorRC</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NumeroParentId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>PerfilPropietarioCaso</name>
            <value>
                <elementReference>$Record.Owner:User.Profile.Name</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RamoCaso</name>
            <value>
                <elementReference>$Record.ProductGroupDescription__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ResponsableNegocio</name>
            <value>
                <elementReference>ResponsableNegocio</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>TipoCaso</name>
            <value>
                <elementReference>$Record.Type</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>VerticalCaso</name>
            <value>
                <elementReference>$Record.Industry__c</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <description>Se recupera la cola a la que se deberá enrutar este tipo de comunicados sin los datos de las DTs a las que enrutar</description>
        <name>GetGenesysCloudQueueAction</name>
        <label>Obtener cola de Genesys Cloud</label>
        <locationX>1262</locationX>
        <locationY>492</locationY>
        <connector>
            <targetReference>Asignamos_variables_generico</targetReference>
        </connector>
        <flowName>GenesysQueueRouter</flowName>
        <inputAssignments>
            <name>routeIndustry</name>
            <value>
                <elementReference>$Record.Industry__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>routeType</name>
            <value>
                <elementReference>$Record.Origin</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>routeValue</name>
            <value>
                <elementReference>$Record.CallCenter__c</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <description>Se recupera la cola a la que se deberá enrutar este tipo de comunicados. En los casos en los que la cuenta asociada al caso sea de tipo Intermediario, se les pasará los valores contenidos en los campos &quot;Email Particulares&quot; e &quot;Email Administración&quot;</description>
        <name>Obtener_cola_de_Genesys_Cloud_desde_Intermediary</name>
        <label>Obtener cola de Genesys Cloud desde Intermediary</label>
        <locationX>998</locationX>
        <locationY>492</locationY>
        <connector>
            <targetReference>Asignamos_variables_Intermediary</targetReference>
        </connector>
        <flowName>GenesysQueueRouter</flowName>
        <inputAssignments>
            <name>emailAdministracion</name>
            <value>
                <elementReference>$Record.Account.AdministrationEmail__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>emailParticulares</name>
            <value>
                <elementReference>$Record.Account.IndividualsEmail__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>routeIndustry</name>
            <value>
                <elementReference>$Record.Industry__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>routeType</name>
            <value>
                <elementReference>$Record.Origin</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>routeValue</name>
            <value>
                <elementReference>$Record.CallCenter__c</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <name>PriorityCalculationSubflow</name>
        <label>Calcular Prioridad</label>
        <locationX>1964</locationX>
        <locationY>1416</locationY>
        <connector>
            <targetReference>genesysCloudRouteMessageAction</targetReference>
        </connector>
        <flowName>EmailMessagePriorityCalculation</flowName>
        <inputAssignments>
            <name>caseCallCenter</name>
            <value>
                <elementReference>$Record.CallCenter__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>caseId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>isResponse</name>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <variables>
        <name>genesysFlowId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>genesysQueueID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>genesysQueueName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Identificador de la interacción producida por el enrutado en Genesys Cloud.</description>
        <name>interactionId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>salesforceQueue</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Group</objectType>
    </variables>
</Flow>
